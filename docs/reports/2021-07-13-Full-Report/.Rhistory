# Chunk 1: global_options
w = 7
h = 7
#knitr::opts_chunk$set(fig.width=w, fig.height=h, fig.path='figs/',
#                      echo=FALSE, warning=FALSE, message=FALSE)
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
options(xtable.comment = FALSE)
# Chunk 2: setup
library(stargazer)
library(ggplot2)
library(gridExtra)
library(xtable)
library(papeR)
library(scales)
library(ggplot2)
library(reshape2)
library(dplyr)
df <- read.csv("table.wide.csv")
df$tbv <- df$volume_tissue + df$volume_lesion + df$volume_csf
df$site <- as.factor(df$site)
df$timepoint <- as.factor(df$timepoint)
df$fraction_left <- df$midline_tissue_volume_left / df$tbv
df$fraction_right <- df$midline_tissue_volume_right / df$tbv
df$fraction_lesion <- df$volume_lesion / df$tbv
df$fraction_csf <- df$volume_csf / df$tbv
df$t2_snr <- df$t2_qa_snr
df$adc_snr <- df$adc_qa_snr
# Chunk 3: plot_snr
sub.df <- df[,c("site", "adc_snr", "t2_snr")]
melted <- melt(sub.df, id.vars=c("site"))
my.plot <- ggplot(data=melted, aes(x=site, y=value, fill=variable)) + geom_point(position=position_jitterdodge(jitter.width=0.2), aes(color=variable), alpha=0.2) + geom_boxplot(alpha=0.5, outlier.shape=NA) + ylim(0, 15)
grid.arrange(my.plot, nrow = 1)
# Chunk 4: table_snr
sub.df <- df[,c("site", "adc_snr", "t2_snr")]
melted <- melt(sub.df, id.vars=c("site"))
grouped <- group_by(melted, site, variable)
xtable(summarise(grouped, num=length(value), mean=mean(value, na.rm=T), sd=sd(value, na.rm=T), min=min(value, na.rm=T), max=max(value, na.rm=T), cv=sd/mean))
grouped <- group_by(melted, variable)
xtable(summarise(grouped, num=length(value), mean=mean(value, na.rm=T), sd=sd(value, na.rm=T), min=min(value, na.rm=T), max=max(value, na.rm=T), cv=sd/mean))
# Chunk 5: plot_tbv_site
my.plot <- ggplot(data=df, aes(x=site, y=tbv, fill=timepoint)) + geom_point(position = position_jitterdodge(jitter.width=0.2), aes(color=timepoint), alpha=0.35) + geom_boxplot(alpha=0.2, outlier.shape=NA) + ylim(0, 30)
grid.arrange(my.plot, nrow = 1)
# Chunk 6: plot_tbv
my.plot <- ggplot(data=df, aes(x=site, y=tbv, fill=site)) + geom_jitter(alpha=0.2, width=0.15, aes(color=site)) + geom_boxplot(alpha=0.5, outlier.shape=NA)
grid.arrange(my.plot, nrow = 1)
# Chunk 7: table_tbv
sub.df <- df[,c("site", "tbv")]
melted <- melt(sub.df, id.vars=c("site"))
grouped <- group_by(melted, site, variable)
xtable(summarise(grouped, num=length(value), mean=mean(value, na.rm=T), sd=sd(value, na.rm=T), min=min(value, na.rm=T), max=max(value, na.rm=T), cv=sd/mean))
grouped <- group_by(melted, variable)
xtable(summarise(grouped, num=length(value), mean=mean(value, na.rm=T), sd=sd(value, na.rm=T), min=min(value, na.rm=T), max=max(value, na.rm=T), cv=sd/mean))
# Chunk 8: plot_lesion_early
my.plot <- ggplot(data=df[df$timepoint == "early",], aes(x=site, y=volume_lesion, fill=site)) + geom_jitter(alpha=0.2, width=0.15, aes(color=site)) + geom_boxplot(alpha=0.5, outlier.shape=NA)
grid.arrange(my.plot, nrow = 1)
# Chunk 9: table_lesion_early
sub.df <- df[df$timepoint=="early",c("site", "volume_lesion")]
melted <- melt(sub.df, id.vars=c("site"))
grouped <- group_by(melted, site, variable)
xtable(summarise(grouped, num=length(value), mean=mean(value, na.rm=T), sd=sd(value, na.rm=T), min=min(value, na.rm=T), max=max(value, na.rm=T), cv=sd/mean))
grouped <- group_by(melted, variable)
xtable(summarise(grouped, num=length(value), mean=mean(value, na.rm=T), sd=sd(value, na.rm=T), min=min(value, na.rm=T), max=max(value, na.rm=T), cv=sd/mean))
# Chunk 10: plot_fraction_lesion_early
my.plot <- ggplot(data=df[df$timepoint == "early",], aes(x=site, y=fraction_lesion, fill=site)) + geom_jitter(alpha=0.2, width=0.15, aes(color=site)) + geom_boxplot(alpha=0.5, outlier.shape=NA)
grid.arrange(my.plot, nrow = 1)
# Chunk 11: table_fraction_lesion_early
sub.df <- df[df$timepoint=="early",c("site", "fraction_lesion")]
melted <- melt(sub.df, id.vars=c("site"))
grouped <- group_by(melted, site, variable)
xtable(summarise(grouped, num=length(value), mean=mean(value, na.rm=T), sd=sd(value, na.rm=T), min=min(value, na.rm=T), max=max(value, na.rm=T), cv=sd/mean))
grouped <- group_by(melted, variable)
xtable(summarise(grouped, num=length(value), mean=mean(value, na.rm=T), sd=sd(value, na.rm=T), min=min(value, na.rm=T), max=max(value, na.rm=T), cv=sd/mean))
# Chunk 12: plot_csf_both
my.plot <- ggplot(data=df, aes(x=site, y=volume_csf, fill=timepoint)) + geom_point(position = position_jitterdodge(jitter.width=0.2), aes(color=timepoint), alpha=0.35) + geom_boxplot(alpha=0.2, outlier.shape=NA) + ylim(0, 30)
grid.arrange(my.plot, nrow = 1)
# Chunk 13: table_csf_both
sub.df <- df[,c("timepoint", "site", "volume_csf")]
melted <- melt(sub.df, id.vars=c("timepoint", "site"))
grouped <- group_by(melted, site, timepoint, variable)
xtable(summarise(grouped, num=length(value), mean=mean(value, na.rm=T), sd=sd(value, na.rm=T), min=min(value, na.rm=T), max=max(value, na.rm=T), cv=sd/mean))
grouped <- group_by(melted, timepoint, variable)
xtable(summarise(grouped, num=length(value), mean=mean(value, na.rm=T), sd=sd(value, na.rm=T), min=min(value, na.rm=T), max=max(value, na.rm=T), cv=sd/mean))
# Chunk 14: plot_fraction_csf_both
my.plot <- ggplot(data=df, aes(x=site, y=fraction_csf, fill=timepoint)) + geom_point(position = position_jitterdodge(jitter.width=0.2), aes(color=timepoint), alpha=0.35) + geom_boxplot(alpha=0.2, outlier.shape=NA) + ylim(0, 0.1)
grid.arrange(my.plot, nrow = 1)
# Chunk 15: table_fraction_csf_both
sub.df <- df[,c("timepoint", "site", "fraction_csf")]
melted <- melt(sub.df, id.vars=c("timepoint", "site"))
grouped <- group_by(melted, site, timepoint, variable)
xtable(summarise(grouped, num=length(value), mean=mean(value, na.rm=T), sd=sd(value, na.rm=T), min=min(value, na.rm=T), max=max(value, na.rm=T), cv=sd/mean))
grouped <- group_by(melted, timepoint, variable)
xtable(summarise(grouped, num=length(value), mean=mean(value, na.rm=T), sd=sd(value, na.rm=T), min=min(value, na.rm=T), max=max(value, na.rm=T), cv=sd/mean))
# Chunk 16: plot_shift_both
my.plot <- ggplot(data=df, aes(x=site, y=midline_shift_index, fill=timepoint)) + geom_point(position = position_jitterdodge(jitter.width=0.2), aes(color=timepoint), alpha=0.35) + geom_boxplot(alpha=0.2, outlier.shape=NA) + ylim(-.50, .50)
grid.arrange(my.plot, nrow = 1)
# Chunk 17: table_shift_both
sub.df <- df[,c("timepoint", "site", "midline_shift_index")]
melted <- melt(sub.df, id.vars=c("timepoint", "site"))
grouped <- group_by(melted, site, timepoint, variable)
xtable(summarise(grouped, num=length(value), mean=mean(value, na.rm=T), sd=sd(value, na.rm=T), min=min(value, na.rm=T), max=max(value, na.rm=T), cv=sd/mean))
grouped <- group_by(melted, timepoint, variable)
xtable(summarise(grouped, num=length(value), mean=mean(value, na.rm=T), sd=sd(value, na.rm=T), min=min(value, na.rm=T), max=max(value, na.rm=T), cv=sd/mean))
# Chunk 18: plot_hemi_early
sub.df <- df[df$timepoint=="early",c("site", "fraction_left", "fraction_right")]
melted <- melt(sub.df, id.vars=c("site"))
my.plot <- ggplot(data=melted, aes(x=site, y=value, fill=variable)) + geom_point(position = position_jitterdodge(), aes(color=variable), alpha=0.35) + geom_boxplot(alpha=0.2, outlier.shape=NA)
grid.arrange(my.plot, nrow = 1)
# Chunk 19: table_hemi_early
sub.df <- df[df$timepoint=="early",c("site", "fraction_left", "fraction_right")]
melted <- melt(sub.df, id.vars=c("site"))
grouped <- group_by(melted, site, variable)
xtable(summarise(grouped, num=length(value), mean=mean(value, na.rm=T), sd=sd(value, na.rm=T), min=min(value, na.rm=T), max=max(value, na.rm=T), cv=sd/mean))
grouped <- group_by(melted, variable)
xtable(summarise(grouped, num=length(value), mean=mean(value, na.rm=T), sd=sd(value, na.rm=T), min=min(value, na.rm=T), max=max(value, na.rm=T), cv=sd/mean))
# Chunk 20: plot_hemi_late
sub.df <- df[df$timepoint=="late",c("site", "fraction_left", "fraction_right")]
melted <- melt(sub.df, id.vars=c("site"))
my.plot <- ggplot(data=melted, aes(x=site, y=value, fill=variable)) + geom_point(position = position_jitterdodge(), aes(color=variable), alpha=0.35) + geom_boxplot(alpha=0.2, outlier.shape=NA)
grid.arrange(my.plot, nrow = 1)
# Chunk 21: table_hemi_late
sub.df <- df[df$timepoint=="late",c("site", "fraction_left", "fraction_right")]
melted <- melt(sub.df, id.vars=c("site"))
grouped <- group_by(melted, site, variable)
xtable(summarise(grouped, num=length(value), mean=mean(value, na.rm=T), sd=sd(value, na.rm=T), min=min(value, na.rm=T), max=max(value, na.rm=T), cv=sd/mean))
grouped <- group_by(melted, variable)
xtable(summarise(grouped, num=length(value), mean=mean(value, na.rm=T), sd=sd(value, na.rm=T), min=min(value, na.rm=T), max=max(value, na.rm=T), cv=sd/mean))
# Chunk 22: plot_lesion_shift
my.plot <- ggplot(data=df[df$timepoint=="early",], aes(x=volume_lesion, y=midline_shift_index, color=site)) + geom_point(alpha=0.5) + geom_smooth(method="lm") + ylim(0, 0.5)
grid.arrange(my.plot, nrow = 1)
# Chunk 23: plot_lesion_shift_time
early.df <- df[df$timepoint=="early", c("subject", "site", "fraction_lesion")]
late.df <- df[df$timepoint=="late", c("subject", "midline_shift_index")]
sub.df <- merge(early.df, late.df, field="subject")
my.plot <- ggplot(data=sub.df, aes(x=fraction_lesion, y=midline_shift_index, color=site)) + geom_point(alpha=0.5) + geom_smooth(method="lm") + xlab("early timepoint lesion fraction") + ylab("late timepoint midline shift")
grid.arrange(my.plot, nrow = 1)
ggplot(data=df, aes(x=site, y=tbv, fill=timepoint)) + geom_point(position = position_jitterdodge(jitter.width=0.2), aes(color=timepoint), alpha=0.35) + geom_boxplot(alpha=0.2, outlier.shape=NA) + ylim(0, 30)
df$tbv
ggplot(data=df, aes(x=site, y=tbv, fill=timepoint)) + geom_point(position = position_jitterdodge(jitter.width=0.2), aes(color=timepoint), alpha=0.35) + geom_boxplot(alpha=0.2, outlier.shape=NA)
ggplot(data=df, aes(x=site, y=volume_tissue, fill=timepoint)) + geom_point(position = position_jitterdodge(jitter.width=0.2), aes(color=timepoint), alpha=0.35) + geom_boxplot(alpha=0.2, outlier.shape=NA)
